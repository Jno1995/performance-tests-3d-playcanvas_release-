var ModelManager=pc.createScript("modelManager");ModelManager.attributes.add("mapModel",{type:"asset",assetType:"model",title:"mapModel"});ModelManager.attributes.add("heroModels",{type:"asset",assetType:"model",array:true,title:"heroModels"});ModelManager.attributes.add("animation",{type:"asset",assetType:"animation",array:true,title:"animation"});ModelManager.attributes.add("modelCount",{type:"entity",title:"modelCount"});ModelManager.prototype.initialize=function(){var self=this;this.heroModels.splice(3,1);this.animation.splice(3,1);this.app.addTweenManager();this.currentLevel=0;self.entity.findByName("map").addComponent("model",{asset:this.mapModel,});self.entity.findByName("map").setPosition(0,-0.2,0)};ModelManager.prototype.updatePlayerNumber=function(num,modelManager){if(num<0){num=0}var _newCurrentLevel=Math.floor(num/100);modelManager.moveUpCamera(_newCurrentLevel,modelManager);var _heros=modelManager.entity.findByName("heros");if(!_heros){var _heros=new pc.Entity();_heros.name="heros";modelManager.entity.addChild(_heros)}var _k=num-_heros.children.length;var add=function(){var index=Math.floor(Math.random()*modelManager.heroModels.length);var model=modelManager.heroModels[index];var anima=modelManager.animation[index];var _newEntity=new pc.Entity();_newEntity.name="model_"+index;_newEntity.addComponent("model",{asset:model,});_newEntity.addComponent("animation",{assets:[anima]});var _x=(-8-3*_newCurrentLevel)+Math.random()*(16+6*_newCurrentLevel);var _z=-20+Math.random()*(26+5*_newCurrentLevel);var _scaleValue=1;switch(index){case 0:case 1:case 5:_scaleValue=0.5;break;case 2:_scaleValue=0.4;break;case 4:_scaleValue=2;break}_newEntity.setLocalScale(_scaleValue,_scaleValue,_scaleValue);_newEntity.setPosition(_x,1.5,_z);modelManager.entity.findByName("heros").addChild(_newEntity);modelManager.moveTo(modelManager,_newEntity,_newCurrentLevel)};var reduce=function(){_heros.children.pop().destroy()};for(var i=0;i<Math.abs(_k);i++){if(_k>0){add()}else{if(_k<0){reduce()}}}modelManager.currentLevel=_newCurrentLevel};ModelManager.prototype.moveUpCamera=function(currentLevel,modelManager){var _camera=modelManager.app.root.findByName("Camera").findComponent("camera");var _pos=_camera.entity.forward.clone().scale(-8*Math.abs(currentLevel-modelManager.currentLevel));var _ePos=_camera.entity.getPosition();if(currentLevel>modelManager.currentLevel){_ePos.add(_pos)}else{if(currentLevel<modelManager.currentLevel){_ePos.sub(_pos)}}var _tween=_camera.entity.tween(_camera.entity.getLocalPosition());_tween.to(_ePos,1,pc.SineOut).start()};ModelManager.prototype.moveTo=function(modelManager,entity,currentLevel){var nextPoint=new pc.Vec3((-8-3*currentLevel)+Math.random()*(16+6*currentLevel),0,-20+Math.random()*(26+5*currentLevel));var offect=nextPoint.clone().sub(entity.getLocalPosition());const costTime=offect.length()/2;var _tween=entity.tween(entity.getLocalPosition());_tween.to(nextPoint,costTime).on("complete",function(){modelManager.moveTo(modelManager,entity,currentLevel)}).start()};