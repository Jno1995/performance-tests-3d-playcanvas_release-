var ModelLoader=pc.createScript("modelLoader");ModelLoader.attributes.add("models",{type:"asset",assetType:"json",array:true,title:"models"});ModelLoader.prototype.initialize=function(){this.needLoadNum=6;this.modelAssetsIndex=0;this.modelsLoadFinish=false;this.currentLevel=0;this.resModel=[];this.app.addTweenManager();if(this.resModel.length===0){this.loadGltfModelsRes(0,this,true)}this.heros=new pc.Entity();this.heros.name="heros";this.entity.addChild(this.heros)};ModelLoader.prototype.loadGltfModelsRes=function(index,mLoader,needShow){if(mLoader.tipsLab){mLoader.tipsLab.destroy();mLoader.tipsLab=null}mLoader.tipsLab=mLoader.app.root.findByPath("Scene2/2D Screen/checkbox0/Text").clone();mLoader.tipsLab.name="tips";mLoader.tipsLab.findComponent("element").text="ModelsLoading...";mLoader.app.root.findByPath("Scene2/2D Screen").addChild(mLoader.tipsLab);var gltf=mLoader.models[index].resource;loadGltf(gltf,mLoader.app.graphicsDevice,function(err,res){mLoader.resModel[Number(res.model.graph.name)]=res.model;mLoader.tipsLab.findComponent("element").text="Models_"+index+"_LoadFinish!";setTimeout(function(){mLoader.tipsLab.destroy()},800);mLoader.modelsLoadFinish=true;if(needShow){mLoader.updateModels(mLoader)}},{basePath:"files/assets/gltf/"+index+"/"})};ModelLoader.prototype.updateModels=function(mLoader){if(!mLoader.modelsLoadFinish){return}var num=mLoader.needLoadNum;if(num<0){num=0}var _newCurrentLevel=Math.floor(num/100);var _l=mLoader.heros.children.length;mLoader.moveUpCamera(_newCurrentLevel,mLoader);for(var i=0;i<_l;i++){mLoader.heros.children.pop().destroy()}for(var k=0;k<num;k++){var _model=mLoader.resModel[mLoader.modelAssetsIndex].clone();var _newNode=new pc.Entity();_newNode.addComponent("model").model=_model;mLoader.heros.addChild(_newNode);var _x=(-8-3*_newCurrentLevel)+Math.random()*(16+6*_newCurrentLevel);var _y=0;var _z=-20+Math.random()*(26+5*_newCurrentLevel);_newNode.setPosition(_x,_y,_z);switch(mLoader.modelAssetsIndex){case 0:_newNode.setLocalScale(0.75,0.75,0.75);break;case 1:case 4:_newNode.setLocalScale(0.001,0.001,0.001);break}}mLoader.currentLevel=_newCurrentLevel};ModelLoader.prototype.moveUpCamera=function(currentLevel,mLoader){var _camera=mLoader.app.root.findByName("Camera").findComponent("camera");var _pos=_camera.entity.forward.clone().scale(-8*Math.abs(currentLevel-mLoader.currentLevel));var _ePos=_camera.entity.getPosition();if(currentLevel>mLoader.currentLevel){_ePos.add(_pos)}else{if(currentLevel<mLoader.currentLevel){_ePos.sub(_pos)}}var _tween=_camera.entity.tween(_camera.entity.getLocalPosition());_tween.to(_ePos,1,pc.SineOut).start()};